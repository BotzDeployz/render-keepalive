name: üöÄ Keep Render Alive FIXED

on:
  schedule:
    # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —á–∞—Å—Ç–æ—Ç—É –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
    - cron: '*/5 * * * *'
  
  workflow_dispatch:

jobs:
  ping-services:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    
    steps:
      # –®–∞–≥ 1: –ü–∏–Ω–≥—É–µ–º –±—ç–∫–µ–Ω–¥ (API) - –ë–ï–ó exit 0!
      - name: üîç Ping Backend Service
        run: |
          echo "=== Pinging Backend ==="
          BACKEND_URL="https://spotter-backend-zxsj.onrender.com"
          BACKEND_STATUS="unknown"
          
          # –î–µ–ª–∞–µ–º 3 –ø–æ–ø—ã—Ç–∫–∏
          for attempt in {1..3}; do
            echo "Attempt $attempt..."
            RESPONSE_CODE=$(curl -s -o /dev/null -w "%{http_code}" -m 20 "$BACKEND_URL/api/health" || echo "000")
            
            if [ "$RESPONSE_CODE" -eq 200 ]; then
              echo "‚úÖ Backend is ALIVE! Response code: $RESPONSE_CODE"
              BACKEND_STATUS="alive"
              break  # –í—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞, –Ω–æ –Ω–µ –∏–∑ –≤—Å–µ–≥–æ —à–∞–≥–∞!
            else
              echo "‚ö†Ô∏è  Backend response: $RESPONSE_CODE"
              if [ $attempt -lt 3 ]; then
                sleep 3
              fi
            fi
          done
          
          if [ "$BACKEND_STATUS" != "alive" ]; then
            echo "‚ùå Backend might be DOWN after 3 attempts"
          fi

      # –®–∞–≥ 2: –ü–∏–Ω–≥—É–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
      - name: üé® Ping Frontend Service
        run: |
          echo "=== Pinging Frontend ==="
          FRONTEND_URL="https://spotter-frontend-1.onrender.com"
          
          RESPONSE_CODE=$(curl -s -o /dev/null -w "%{http_code}" -m 20 "$FRONTEND_URL" || echo "000")
          
          if [ "$RESPONSE_CODE" -eq 200 ] || [ "$RESPONSE_CODE" -eq 304 ] || [ "$RESPONSE_CODE" -eq 302 ] || [ "$RESPONSE_CODE" -eq 301 ]; then
            echo "‚úÖ Frontend is ALIVE! Response code: $RESPONSE_CODE"
          else
            echo "‚ö†Ô∏è  Frontend response: $RESPONSE_CODE"
          fi
          
      # –®–∞–≥ 3: –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
      - name: üìä Log Completion
        run: |
          echo "================================="
          echo "‚úÖ Keep-alive cycle completed at: $(date -u '+%H:%M:%S UTC')"
          echo "Next run in ~5 minutes"
