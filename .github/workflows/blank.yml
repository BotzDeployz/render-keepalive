name: üöÄ Keep Render Alive

on:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–µ 14 –º–∏–Ω—É—Ç
    # –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ: Render —Å–ø–∏—Ç –ø–æ—Å–ª–µ 15 –º–∏–Ω—É—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    - cron: '*/14 * * * *'
  
  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  workflow_dispatch:

jobs:
  ping-services:
    runs-on: ubuntu-latest
    
    steps:
      # –®–∞–≥ 1: –ü–∏–Ω–≥—É–µ–º –±—ç–∫–µ–Ω–¥ (API)
      - name: üîç Ping Backend Service
        run: |
          echo "=== Pinging Backend ==="
          BACKEND_URL="https://spotter-backend-zxsj.onrender.com"
          
          # –î–µ–ª–∞–µ–º 3 –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞ —Å–ª—É—á–∞–π –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
          for attempt in {1..3}; do
            echo "Attempt $attempt..."
            RESPONSE_CODE=$(curl -s -o /dev/null -w "%{http_code}" -m 15 "$BACKEND_URL/api/health" || echo "000")
            
            if [ "$RESPONSE_CODE" -eq 200 ]; then
              echo "‚úÖ Backend is ALIVE! Response code: $RESPONSE_CODE"
              exit 0
            else
              echo "‚ö†Ô∏è  Backend response: $RESPONSE_CODE"
              if [ $attempt -lt 3 ]; then
                sleep 5  # –ñ–¥–µ–º 5 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–æ–π
              fi
            fi
          done
          
          echo "‚ùå Backend might be DOWN after 3 attempts"
          # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (Telegram, Discord –∏ —Ç.–¥.)

      # –®–∞–≥ 2: –ü–∏–Ω–≥—É–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
      - name: üé® Ping Frontend Service
        run: |
          echo "=== Pinging Frontend ==="
          FRONTEND_URL="https://spotter-frontend-1.onrender.com/profile"
          
          RESPONSE_CODE=$(curl -s -o /dev/null -w "%{http_code}" -m 15 "$FRONTEND_URL" || echo "000")
          
          if [ "$RESPONSE_CODE" -eq 200 ] || [ "$RESPONSE_CODE" -eq 304 ] || [ "$RESPONSE_CODE" -eq 302 ]; then
            echo "‚úÖ Frontend is ALIVE! Response code: $RESPONSE_CODE"
          else
            echo "‚ö†Ô∏è  Frontend response: $RESPONSE_CODE"
          fi

